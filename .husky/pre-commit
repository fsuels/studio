#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "[husky] Running pre-commit quality checks..."

echo "[husky] Step 1/2: Integrated quality system"
node scripts/integrated-quality-system.js
QUALITY_EXIT=$?

if [ $QUALITY_EXIT -ne 0 ]; then
  echo "[husky] Integrated quality system blocked the commit."
  echo "[husky] Review decision reports in decision-reports/ and rerun 'npm run full-check'."
  exit $QUALITY_EXIT
fi

echo "[husky] Step 2/2: lint-staged"
npm run lint-staged
LINT_EXIT=$?

if [ $LINT_EXIT -ne 0 ]; then
  echo "[husky] lint-staged found issues. Fix them and try again."
  exit $LINT_EXIT
fi

echo "[husky] All pre-commit checks passed."
