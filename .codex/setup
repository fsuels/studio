#!/usr/bin/env bash
set -euo pipefail

# Skip Playwright browser download (helps in sandbox)
export PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1

echo "ðŸ”§  Installing dependencies"
npm ci --prefer-offline --no-audit --progress=false

echo "ðŸ›    Building and exporting Next.js site"
npm run build
npm run export   # puts static files in apps/web/out

echo "ðŸ”  Running Lighthouse-CI"
if [ -f lighthouserc.json ]; then
  npx lhci autorun || true     # never fail the container
else
  echo "â„¹ï¸   No lighthouserc.json â€“ skipping LHCI"
fi

# Optional global helpers for Codex
npm install -g eslint prettier typescript firebase-tools >/dev/null 2>&1 || true

echo "âœ…  Setup finished"
