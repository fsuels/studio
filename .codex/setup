#!/usr/bin/env bash
set -euo pipefail

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  Codex bootstrap: minimal setup only (skip npm ci & next build) to avoid  â•‘
# â•‘  300 s timeout.                                                            â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export npm_config_loglevel=error

echo "ðŸ”§  [setup] Starting minimal environment bootstrapâ€¦"

# 1ï¸âƒ£  Persist Firebase key (if Codex injected it)
if [[ -n "${FIREBASE_SERVICE_ACCOUNT_KEY_JSON:-}" ]]; then
  printf "FIREBASE_SERVICE_ACCOUNT_KEY_JSON='%s'\n" \
    "${FIREBASE_SERVICE_ACCOUNT_KEY_JSON}" >> .env
fi

# 2ï¸âƒ£  Skip installing all dependencies and skip building the Next.js site.
#     (npm ci + npm run build routinely exceed 300 s on a fresh workspace.)
echo "âš ï¸   Skipping 'npm ci' and 'npm run build' to prevent startup timeout."

# 3ï¸âƒ£  Install only the small CLIs Codex sometimes calls (these are quick)
npm install -g eslint prettier typescript firebase-tools > /dev/null 2>&1

echo "âœ…  Minimal setup finished â€“ ready for Codex."
