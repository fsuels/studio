# Template Verification System

## Overview

The Template Verification System ensures all legal document templates meet quality standards and prevents issues like duplicate content. This system was implemented after discovering all templates contained identical "Vehicle Bill of Sale" content.

## üõ°Ô∏è Protection Mechanisms

### 1. **Automated Verification Script** (`scripts/verify-templates.ts`)
- Validates all templates against quality standards
- Detects duplicate content across templates
- Ensures proper document structure and formatting
- Checks for required legal elements

### 2. **Real-time Monitoring** (`scripts/template-monitor.ts`)
- Live dashboard showing template health
- Monitors file changes in real-time
- Alerts on invalid template modifications
- Tracks quality metrics

### 3. **Auto-Fix Tool** (`scripts/auto-fix-templates.ts`)
- Automatically fixes common template issues
- Updates formatting and structure
- Adds missing required elements
- Maintains consistency across templates

### 4. **Pre-commit Hooks** (`.husky/pre-commit`)
- Runs verification before allowing commits
- Prevents invalid templates from being committed
- Ensures quality standards are maintained

### 5. **CI/CD Pipeline** (`.github/workflows/template-verification.yml`)
- Automated verification on every push
- Checks for duplicate content
- Validates template coverage
- Comments on PRs with issues

## üìã Validation Rules

### Global Requirements
- **Minimum word count:** 500 words
- **Maximum word count:** 10,000 words
- **Required sections:**
  - Numbered sections (## 1., ## 2., etc.)
  - Signature section
  - Legal notice/disclaimer
- **Required elements:**
  - Handlebars variables (minimum 5)
  - Proper markdown structure
  - Professional footer

### Document-Specific Requirements
Each document type has specific requirements:
- Required sections relevant to document type
- Specific variables needed
- Content patterns that match document purpose

### Prohibited Content
- Duplicate "Vehicle Bill of Sale" content
- Old template formats
- Missing legal notices
- Incorrect document types

## üöÄ Usage

### Run Template Verification
```bash
npm run verify-templates
```

### Monitor Templates in Real-time
```bash
npm run monitor-templates
```

### Auto-fix Template Issues
```bash
npm run fix-templates
```

### Generate Verification Report
```bash
npm run template-report
```

## üìä Quality Metrics

The system tracks:
- Total templates
- Valid vs invalid templates
- Average word count
- Average variable count
- Quality score (0-100%)
- Recent changes
- Duplicate content detection

## üîß Workflow

### Adding New Templates

1. Create template following standards
2. Include all required sections
3. Add appropriate Handlebars variables
4. Include legal notice
5. Run verification before committing

### Modifying Templates

1. Make changes to template
2. Run `npm run verify-templates` locally
3. Fix any reported issues
4. Use `npm run fix-templates` for auto-fixes
5. Commit only after verification passes

### Template Standards

#### Header Format
```markdown
# Document Title

---

**DOCUMENT TYPE**

Introduction text...
```

#### Section Format
```markdown
## 1. Section Title

### 1.1 Subsection
Content...

### 1.2 Another Subsection
Content...
```

#### Variables
```handlebars
{{variable_name}}
{{#if condition}}
Conditional content
{{/if}}
```

#### Signature Section
```markdown
## Signatures

**IN WITNESS WHEREOF**, the parties have executed this agreement...

| Signature | Date |
|-----------|------|
| _________________________________ | {{date}} |
```

#### Footer
```markdown
**IMPORTANT LEGAL NOTICE:** [Legal disclaimer text]

*Template generated by 123LegalDoc - Professional Legal Document Platform*
```

## üö® Alerts and Monitoring

### Quality Score Thresholds
- **90-100%**: Excellent (Green)
- **70-89%**: Good (Yellow)
- **Below 70%**: Needs Attention (Red)

### Automatic Alerts
- Invalid template detected
- Duplicate content found
- Quality score drops below 90%
- Template structure violations

## üîç Troubleshooting

### Common Issues

1. **Unbalanced Handlebars**
   - Error: Mismatched {{#if}} and {{/if}}
   - Fix: Run auto-fix or manually balance conditions

2. **Missing Sections**
   - Error: Required section not found
   - Fix: Add missing section with proper numbering

3. **Duplicate Content**
   - Error: Multiple templates have same content
   - Fix: Replace with correct document-specific content

4. **Low Word Count**
   - Error: Document too short
   - Fix: Add comprehensive legal content

### Manual Verification

To manually check a specific template:
```typescript
import { TemplateVerifier } from './scripts/verify-templates';

const verifier = new TemplateVerifier('/path/to/templates');
const result = await verifier.verifyTemplate('/path/to/template.md');
console.log(result);
```

## üìà Continuous Improvement

The verification system helps:
- Maintain consistent quality
- Prevent regression issues
- Ensure legal compliance
- Build user trust
- Support scalability

Regular reviews and updates to validation rules ensure the system evolves with business needs.

## üéØ Goals

1. **Zero duplicate content** across templates
2. **100% verification coverage** before deployment
3. **90%+ quality score** maintained
4. **Automated fixes** for common issues
5. **Real-time monitoring** and alerts

This system ensures 123LegalDoc maintains the highest quality standards for legal document templates, preventing the issues that led to its creation.